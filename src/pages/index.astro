---
import { getCollection } from 'astro:content'
import Layout from '../layouts/Layout.astro'
import { Image } from 'astro:assets'
import { twMerge } from 'tailwind-merge'
import { toTabGroups } from '../utils'
import UserIcon from '../components/icons/UserIcon.astro'
import MusicNoteIcon from '../components/icons/MusicNoteIcon.astro'

const tabs = await getCollection('tabs')
const tabGroups = toTabGroups(tabs)
---

<Layout
  title="Tino's Tabs"
  description="An evergrowing collection of curated guitar tabs. With video references, lyrics, and other useful stuff."
>
  <h1 class="mb-4 text-3xl font-semibold">Tino's Tabs</h1>
  <p class={twMerge('mb-8 max-w-md text-stone-500', 'dark:text-stone-400')}>
    A collection of tabs Iâ€™ve put together throughout the years, with video
    references, lyrics, and other useful stuff. Hope they help!
  </p>
  <ol class="flex flex-col gap-6">
    {
      tabGroups.map((group) => (
        <li
          class={twMerge(
            'flex flex-col gap-3 rounded-2xl bg-stone-50 p-4 pb-0',
            'dark:bg-stone-900',
          )}
        >
          <div class="flex items-center justify-between gap-2">
            <div class="flex flex-col">
              <div class="text-2xl font-semibold leading-tight">
                {group.artist.name}
              </div>
              <div
                class={twMerge('text-sm text-stone-500', 'dark:text-stone-400')}
              >
                {`${group.tabs.length} ${
                  group.tabs.length === 1 ? 'tab' : 'tabs'
                }`}
              </div>
            </div>
            <div
              class={twMerge(
                'relative flex h-12 w-12 items-center justify-center overflow-hidden rounded-full bg-stone-100',
                "after:absolute after:inset-0 after:rounded-full after:ring-1 after:ring-inset after:ring-black/10 after:content-['']",
                'dark:bg-stone-800 dark:after:ring-white/10',
              )}
            >
              <UserIcon
                class={twMerge(
                  'absolute h-11 w-11 translate-y-2 text-stone-200',
                  'dark:text-stone-700',
                )}
              />
              {group.artist.imageURL && (
                <Image
                  src={group.artist.imageURL}
                  alt={`${group.artist.name} Profile Image`}
                  class="relative h-12 w-12 rounded-full object-cover"
                />
              )}
            </div>
          </div>
          <ol class="-mx-4 flex flex-col px-2 pb-2">
            {group.tabs.map((tab) => (
              <li>
                <a
                  href={`/${tab.slug}`}
                  class={twMerge(
                    'group flex items-center gap-3 rounded-lg p-2 transition-colors',
                    'hover:bg-stone-100',
                    'dark:hover:bg-stone-800',
                  )}
                >
                  <div
                    class={twMerge(
                      'relative flex h-10 w-10 items-center justify-center rounded bg-stone-100',
                      "after:absolute after:inset-0 after:rounded after:ring-1 after:ring-inset after:ring-black/10 after:transition-colors after:content-[''] group-hover:after:bg-black/5",
                      'dark:bg-stone-800 dark:after:ring-white/10',
                    )}
                  >
                    <MusicNoteIcon
                      class={twMerge(
                        'absolute h-6 w-6 text-stone-200',
                        'dark:text-stone-700',
                      )}
                    />
                    {tab.data.albumImageURL && (
                      <Image
                        src={tab.data.albumImageURL}
                        alt={`${tab.data.album} Album Cover`}
                        class="relative h-10 w-10 rounded object-cover"
                      />
                    )}
                  </div>
                  <div class="flex flex-col">
                    <div class="leading-snug">{tab.data.title}</div>
                    <div
                      class={twMerge(
                        'text-sm leading-snug text-stone-500',
                        'dark:text-stone-400',
                      )}
                    >
                      {tab.data.album}
                    </div>
                  </div>
                </a>
              </li>
            ))}
          </ol>
        </li>
      ))
    }
  </ol>
</Layout>
